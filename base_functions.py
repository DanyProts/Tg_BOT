
from model_util import AttentionPooling, get_embeddings, device, model, tokenizer, pooling
from difflib import get_close_matches
import torch.nn.functional as F
import torch


def search1(request_user, question_embeddings):
    request_user_emb = get_embeddings([request_user], model, tokenizer, device, pooling)

    question_embeddings = torch.tensor(question_embeddings)

    similarities = F.cosine_similarity(request_user_emb, question_embeddings).numpy()
    if similarities.max() > 0.64:
        return similarities.argmax()
    else:
        return -1
def search(request_user, question_embeddings):
    request_user_emb = get_embeddings([request_user], model, tokenizer, device, pooling)

    question_embeddings = torch.tensor(question_embeddings)

    similarities = F.cosine_similarity(request_user_emb, question_embeddings).numpy()

    return similarities.argmax()

def match(request_user):
  directions = ['Математическое и компьютерное моделирование механических систем и динамических процессов', 'Проектирование систем охлаждения и устройств тепловой защиты в авиационных и ракетных двигателях', 'Системы искусственного интеллекта', 'Цифровые биомедицинские системы', 'Информационные системы и технологии', 'Разработка программно-информационных систем', 'Программное обеспечение систем искусственного интеллекта', 'Проектирование и технология электронно-вычислительных средств', 'Электронное машиностроение', 'Бортовые радиоэлектронные системы ракетно-космической техники', 'Медико-технические информационные технологии', 'Вакуумная и компрессорная техника физических установок', 'Математическое и компьютерное моделирование механических систем и процессов', 'Промышленные и сервисные роботы и РТС (робототехнические средства)', 'Проектирование металлорежущих станков и комплексов', 'Проектирование технологических машин-автоматов и автоматизированных комплексов', 'Проектирование технологических комплексов в кузнечно-штамповочном производстве', 'Холодильная техника и технологии', 'Криогенная техника и специальные системы жизнеобеспечения', 'Боеприпасы', 'Конструирование и производство изделий из композиционных материалов', 'Автомобили и тракторы', 'Космические летательные аппараты и разгонные блоки', 'Технологическое оборудование стартовых комплексов (отраслевая)', 'Суперкомпьютерное моделирование и искусственный интеллект в инженерных задачах', 'Реновация средств и объектов материального производства в машиностроении', 'Автомобили и тракторы', 'Проектирование жидкостных ракетных двигателей', 'Экономика и финансы', 'Математическое и компьютерное моделирование', 'Математическое моделирование динамических процессов в технике', 'Математическое моделирование, численные методы и комплексы программ', 'Математические методы искусственного интеллекта', 'Системы обработки информации и управления', 'Системы обработки информации и управления (отраслевая)', 'Математика и аналитика данных в логистике', 'Анализ, порождение и преобразование программного кода', 'Математическое и компьютерное моделирование в механике', 'Математическое и компьютерное моделирование в аэрокосмической технике (отраслевая)', 'Системы обработки информации и управления (адаптационный план № 2)', 'Искусственный интеллект в системах обработки информации и управления', 'Вычислительные машины, комплексы, системы и сети', 'Математическое и компьютерное моделирование в экономике', 'Конструкция и прочность авиационных и ракетных двигателей, силовых и энергетических установок', 'Программно-аппаратное обеспечение систем искусственного интеллекта', 'Системы автоматизированного проектирования', 'Системы автоматического управления', 'Математические методы защиты информации', 'Разработка защищенного программного обеспечения', 'Безопасность автоматизированных систем критически важных объектов', 'Анализ безопасности информационных систем', 'Разработка автоматизированных систем в защищенном исполнении', 'Безопасность автоматизированных систем в кредитно-финансовой сфере', 'Радиоэлектронные системы и устройства', 'Проектирование и технология радиоэлектронных систем и комплексов', 'Энергетические ядерные реакторы и материалы', 'Оптико-электронные приборы и системы', 'Лазерная техника и лазерные технологии в приборостроении', 'Оптико-электронные приборы и системы специального назначения', 'Электронные и оптико-электронные приборы и системы дистанционного зондирования Земли', 'Электромобили', 'Нетрадиционные и возобновляемые источники энергии', 'Электропривод и автоматика', 'Поршневые и комбинированные двигатели внутреннего сгорания', 'Гидромашины и цифровое управление гидропневмосистемами', 'Динамика и прочность машин', 'Автоматизация технологических процессов и производств', 'Цифровые технологии в автоматизации производства', 'Управление в мехатронных системах', 'Проектирование технологических комплексов в литейном производстве', 'Подводные робототехнические комплексы и аппараты', 'Проектирование инструментальных комплексов в машиностроении', 'Проектирование технологических комплексов механосборочных производств', 'Проектирование технологических комплексов в машиностроении', 'Специальные наземные робототехнические комплексы и системы', 'Проектирование технологических комплексов в прокатном производстве', 'Проектирование металлургических машин и комплексов', 'Проектирование промышленных технологических комплексов с использованием высококонцентрированных потоков энергии', 'Проектирование компрессорных и вакуумных машин и комплексов', 'Проектирование технологических комплексов в сварочном производстве', 'Проектирование технологических комплексов в сварочном производстве', 'Стрелково-пушечное вооружение', 'Инженерное проектирование и цифровые системы управления биотехнологического оборудования', 'Безопасность жизнедеятельности в техносфере', 'Материаловедение в машиностроении', 'Наземно-транспортные технологические средства', 'Крылатые ракеты (отраслевая)', 'Военные гусеничные и колесные машины', 'Ракеты с ракетными двигателями твердого топлива', 'Развертываемые космические конструкции', 'Развертываемые космические конструкции (отраслевая)', 'Аэрокосмические ракетные системы', 'Моделирование и информационные технологии проектирования ракетно-космических систем (отраслевая)', 'Производство и технологическая отработка изделий ракетно-космической техники', 'Интеллектуальные системы управления и обработки данных', 'Производство и технологическая отработка изделий ракетно-космической техники', 'Информационная аналитика', 'Безопасность автоматизированных систем критически важных объектов (адаптационный план № 1)', 'Компьютерная экспертиза', 'Проектирование и технология электронно-вычислительных средств (отраслевая)', 'Биомедицинские технические системы', 'Математическое и программное обеспечение систем управления', 'Автоматизация технологических процессов и производств (адаптационный план №1)', 'Автономные и дистанционные мобильные роботы и космические манипуляторы', 'Роботы гибких производственных систем', 'Проектирование инструментальных комплексов в машиностроении (отраслевая)', 'Проектирование технологических комплексов аддитивного производства', 'Техническая физика', 'Высокотехнологические плазменные и энергетические установки', 'Материаловедение в машиностроении (адаптационный план №1)', 'Военные гусеничные и колесные машины', 'Композитные конструкции и технологии в ракетостроении, космонавтике и авиации', 'Пилотируемые и автоматические космические аппараты и системы (отраслевая)', 'Пусковые устройства, транспортно-установочное оборудование и средства обслуживания стартовых комплексов', 'Композитные конструкции и технологии в ракетостроении, космонавтике и авиации', 'Заправочно-нейтрализационное оборудование, системы термостатирования и газоснабжения технических и стартовых комплексов', 'Проектирование ракетных двигателей твёрдого топлива', 'Проектирование комбинированных реактивных двигателей', 'Авиационные поршневые двигатели', 'Проектирование авиационных двигателей и энергетических установок', 'Проектирование электроракетных двигателей', 'Проектная баллистика ракет и космических систем', 'Системы управления ракет-носителей и космических аппаратов', 'Системы управления ракет', 'Системы управления ракет-носителей и космических аппаратов (отраслевая)', 'Системы управления ракет (отраслевая)', 'Системы управления ракет (отраслевая)', 'Системы управления движением летательных аппаратов (отраслевая)', 'Приборы систем управления летательных аппаратов', 'Приборы и системы управления ракетно-космическими комплексами (отраслевая)', 'Метрология и метрологическое обеспечение', 'Метрология и метрологическое обеспечение (адаптационный план №1)', 'Автономные информационные и управляющие системы', 'Управление инновационной деятельностью', 'Логистика наукоемкого производства', 'Организация инновационных систем управления', 'Управление инвестициями наукоёмких предприятий', 'Инноватика ИТ-проектов', 'Инженерные нанотехнологии в машиностроении', 'Инженерные нанотехнологии в приборостроении', 'Экономика малого и среднего бизнеса', 'Логистика развития кадрового потенциала', 'Менеджмент корпораций', 'Цифровая трансформация бизнеса', 'Маркетинг цифровых технологий', 'Технологии электронного бизнеса', 'Социология техники и инженерной деятельности', 'Экспертиза цифровой информации', 'Теоретическая и прикладная лингвистика', 'Фундаментальная и компьютерная лингвистика', 'Промышленный дизайн', 'Призёр летней энергетической школы ПАО «РусГидро»', 'Призёр конкурса инженерных и исследовательских проектов ПАО «РусГидро»', 'Свидетельство об окончании музыкальной школы или художественной школы', 'Призёр всероссийского конкурса научно-исследовательских работ имени Д.И. Менделеева', 'Призёр (3 степень) oлимпиады III уровня из перечня РСОШ', 'Призёр (3 степень) олимпиады Кружкового движения национальной технологической инициативы', 'Бронзовый знак ГТО', 'Призёр (2 степень) олимпиады III уровня из перечня РСОШ', 'Призёр (2 степень) олимпиады Кружкового движения национальной технологической инициативы', 'Финалист «Большой перемены»', 'Сертификат с отличием класса «Математическая вертикаль ПЛЮС»', 'Призёр олимпиады «Траектория будущего»', 'Призёр арктической олимпиады «Полярный круг»', 'Призёр многопрофильной олимпиады РТУ МИРЭА', 'Призёр детско-юношеской премии «Экология дело каждого»', 'Призёр конкурса цифровых портфолио «Талант НТО»', 'Победитель летней энергетической школы ПАО «РусГидро»', 'Победитель конкурса инженерных и исследовательских проектов ПАО «РусГидро»', 'Призёр Чемпионата «Молодые профессионалы» (WorldSkills Russia)', 'Победитель или призёр Чемпионата по физике «Построй карьеру в ОДК»', 'Победитель всероссийского конкурса научно исследовательских работ имени Д.И. Менделеева', 'Участник программ Яндекс Лицея «Основы программирования на Python» или «Промышленное программирование на Python»', 'Серебряный знак ГТО', 'Волонтёрская деятельность (не менее 100 часов)', 'Призёр (3 степень) олимпиады «Газпром»', 'Победитель всероссийского Детского экологического форума', 'Победитель всероссийского ежегодного конкурса оценки уровня экологической грамотности «Зелёный Зачёт»', 'Кандидат в мастера спорта', 'Золотой знак ГТО', 'Победитель олимпиады III уровня из перечня РСОШ', 'Победитель (1 степень) олимпиады Кружкового движения национальной технологической инициативы', 'Победитель Многопрофильной олимпиады РТУ МИРЭА', 'Победитель олимпиады «Траектория будущего»', 'Победитель арктической олимпиады «Полярный круг»', 'Победитель конкурса цифровых портфолио «Талант НТО»', 'Прохождение военной службы по призыву', 'Победитель детско-юношеской премии «Экология дело каждого»', 'Победитель «Большой перемены»', 'Диплом об окончании ФМШ МГТУ им. Н.Э.Баумана', 'Призёр чемпионата «Абилимпикс»', 'Победитель Чемпионата «Молодые профессионалы» (WorldSkills Russia)', 'Сертификат с отличием Яндекс Лицея «Основы программирования на Python» или «Промышленное программирование на Python»', 'Чемпион России, мастер спорта по видам спорта, включённым в состав Олимпийских игр', 'Призёр (3 степень) олимпиады «Шаг в будущее»', 'Призёр (3 степень) олимпиады «Технокубок»', 'Призёр (2 степень) олимпиады «Газпром»', 'Призёр (3 степень) олимпиады I или II уровня из перечня РСОШ', 'Призёр конференции «Наука для жизни»', 'Призёр конференции «Инженеры будущего»', 'Призёр конференции «Курчатовский проект – от знаний к практике, от практики к результатам»', 'Призёр конкурса «Интеллектуальный мегаполис. Потенциал»', 'Призёр конкурса «Большие вызовы»', 'Призёр открытого городского прикладного конкурса «Спектр»', 'Призёр Московского конкурса «Демонстрационный экзамен»', 'Победитель чемпионата «Абилимпикс»', 'Призёр форума «Шаг в будущее»', 'Призёр (2 степень) олимпиады «Шаг в будущее»', 'Автор лучшей работы олимпиады «Шаг в будущее» по инженерному делу', 'Призёр (2 степень) олимпиады «Технокубок»', 'Победитель олимпиады «Газпром»', 'Призёр (2 степень) олимпиады I или II уровня из перечня РСОШ', 'Победитель конференции «Наука для жизни»', 'Победитель конференции «Инженеры будущего»', 'Победитель конференции «Курчатовский проект – от знаний к практике, от практики к результатам»', 'Победитель конкурса «Интеллектуальный мегаполис. Потенциал»', 'Победитель открытого городского прикладного конкурса «Спектр»', 'Победитель Московского конкурса «Демонстрационный экзамен»', 'Призёр регионального этапа Всероссийской олимпиады школьников по любому предмету', 'Победитель форума «Шаг в будущее»', 'Чемпион Олимпийских игр, чемпион мира, чемпион Европы по видам спорта, включённым в состав Олимпийских игр', 'Аттестат со сведениями о награждении медалью', 'Победитель олимпиады «Шаг в будущее»', 'Победитель олимпиады «Технокубок»', 'Победитель регионального этапа Всероссийской олимпиады школьников по любому предмету', 'Победитель олимпиады I или II уровня из перечня РСОШ', 'Диплом с отличием об окончании ФМШ МГТУ им. Н.Э. Баумана', 'Победитель проекта «IT Школа выбирает сильнейших!»', 'Победитель или призёр заключительного этапа Всероссийской олимпиады школьников (ВОШ)', 'Победитель или призёр IV этапа всеукраинских ученических олимпиад', 'Победитель заключительного этапа всероссийского конкурса научно-технологических проектов «Большие вызовы»', 'Победитель конкурса «Наука. Территория героев»', 'АО «ИТТ»', 'АО «ВНИИРТ»', 'АО «НИИ НПО «ЛУЧ»', 'АО «ЦНИИМАШ»', 'АО «Корпорация «ВНИИЭМ»', 'АО ВНИИ «Сигнал»', 'АО «МКБ «Искра»', 'АО «ЛЗОС»', 'АО «Машзавод «Штамп»', 'АО «МНИИ «Агат»', 'АО «НПО«МОЛНИЯ»', 'АО «НИИП имени В.В.Тихомирова»', 'АО «НПО«Орион»', 'АО «НПП «Исток»им. Шокина»', 'АО «ЦНИРТИ ИМ. АКАДЕМИКА А.И.БЕРГА»', 'АО «РКБ«Глобус»', 'ООО «Зенит»', 'АО «НИТИ им. П.И.Снегирева»', 'АО «НПЦАП»', 'АО «МНИИРС»', 'АО «ВОМЗ»', 'АО «ОКБ «ГИДРОПРЕСС»', 'АО «ОКБ «Новатор»»', 'ФГБНУ ФНАЦ ВИМ', 'ФГУП «НТЦ«Заря»', 'ОКБ им. А. И. Микояна, ПАО «ОАК»', 'АО «ГосМКБ «Радуга» им. А.Я. Березняка»', 'АО «АОМЗ»', 'АО «НИМИ им. В.В. Бахирева»', 'АО «НПО «Курганприбор»', 'ОАО «Научно-производственное объединение «Геофизика-НВ»', 'АО «ЗОМЗ»', 'ОАО «Завод им. В.А. Дегтярева»', 'ИПУ РАН', 'ОАО «НПП «Темп» им. Ф. Короткова»', 'ООО «ССК «Звезда»', 'ПАО «Императорский Тульский оружейный завод»', 'АО «НПО «Прибор» имени С.С. Голембиовского»', 'АО «НИИ «Полюс» им. М.Ф. Стельмаха»', 'АО «ЦНИИАГ»', 'ФГБУ «НИИ ЦПК им. Ю. А. Гагарина»', 'АО «ЦНИИточмаш»', 'АО «ММЗ»', 'ПАО «Яковлев»', 'АО «ДКБА»', 'ППК «Роскадастр»', 'АО «У-У ППО»', 'ФКП «НПО «КЗТМ»', 'ОКБ Сухого', 'АО «Уралтрансмаш»', 'ФАУ «ЦАГИ»', 'АО «НПО Лавочкина»', 'ЦНИИ «Курс»', 'АО «ВПО «Точмаш»', 'ООО «СТЦ»', 'АО «Калугаприбор»', 'АО «ГосМКБ «Радуга» им. А.Я. Березняка»', 'ПАО «Ил»', 'АО «КТРВ»', 'ПАО АК «Рубин»', 'ПАО «РКК «Энергия»', 'ООО «ЛОТЕС ТМ»', 'АО «ЦНИИ «Циклон»', 'АО «Завод №9»', 'АО «ОКБ МЭИ»', 'АО «Петербургский тракторный завод»', 'ФАУ «ЦИАМ им. П.И. БАРАНОВА»','ИУ1', 'ИУ2', 'ИУ3', 'ИУ4', 'ИУ5', 'ИУ6', 'ИУ7', 'ИУ8', 'ИУ9', 'ИУ10', 'ИУ11', 'ИУ12', 'ФН1', 'ФН2', 'ФН3', 'ФН4', 'ФН5', 'ФН7', 'ФН11', 'ФН12', 'РК1', 'РК2', 'РК3', 'РК4', 'РК5', 'РК6', 'РК9', 'МТ1', 'МТ2', 'МТ3', 'МТ4', 'МТ5', 'МТ6', 'МТ7', 'МТ8', 'МТ9', 'МТ10', 'МТ11', 'МТ12', 'МТ13', 'Э1', 'Э2', 'Э3', 'Э4', 'Э5', 'Э6', 'Э7', 'Э8', 'Э9', 'Э10', 'Э2.1', 'РЛ1', 'РЛ2', 'РЛ4', 'РЛ5', 'РЛ6', 'БМТ1', 'БМТ2', 'БМТ3', 'БМТ4', 'БМТ5', 'ИБМ1', 'ИБМ2', 'ИБМ3', 'ИБМ4', 'ИБМ5', 'ИБМ6', 'ИБМ7', 'Л1', 'Л2', 'Л3', 'Л4', 'РКТ1', 'РКТ2', 'РКТ3', 'РКТ4', 'СГН1', 'СГН2', 'СГН3', 'СГН4', 'СМ1', 'СМ2', 'СМ3', 'СМ4', 'СМ5', 'СМ6', 'СМ7', 'СМ8', 'СМ9', 'СМ10', 'СМ11', 'СМ12', 'СМ13', 'ЮР','01.03.03_02', '24.05.02_07', '09.03.01_05', '09.03.03_04', '09.03.02_01', '09.03.04_01', '09.03.04_02', '11.03.03_01', '11.03.04_01', '11.05.01_09', '12.03.04_02', '15.03.02_01', '15.03.03_01', '15.03.06_07', '15.05.01_01', '15.05.01_14', '15.05.01_06', '16.03.03_01', '16.05.01_01', '17.05.01_01', '22.03.01_02', '23.05.01_01', '24.03.01_01', '24.05.01_14', '02.03.01_04', '15.03.01_02', '01.03.02_01', '23.05.01_01', '24.05.02_03', '38.03.01_05', '02.03.01_01', '01.03.04_03', '01.03.04_05', '01.03.04_04', '09.03.01_02', '09.03.01_22', '01.03.04_06', '02.03.01_05', '02.03.01_22', '09.03.01_52', '09.03.01_С1', '09.03.01_03', '02.03.01_03', '24.05.02_08', '09.03.01_С2', '09.03.01_01', '09.03.03_05', '10.05.01_02', '10.05.01_03', '10.05.03_01', '10.05.03_02', '10.05.03_03', '10.05.03_04', '11.05.01_01', '11.05.01_05', '14.05.01_02', '12.03.02_01', '12.03.05_01', '12.05.01_02', '12.05.01_05', '13.03.02_02', '13.03.02_01', '13.03.02_03', '13.03.03_01', '13.03.03_С1', '15.03.03_С1', '15.03.04_01', '15.03.04_С1', '15.03.06_01', '15.05.01_05', '15.03.06_04', '15.05.01_02', '15.05.01_03', '15.05.01_12', '15.05.02_01', '15.05.01_10', '15.05.01_13', '15.05.01_04', '15.05.01_09', '15.05.02_07', '15.05.02_07', '17.05.02_01', '19.03.01_01', '20.03.01_01', '22.03.01_01', '23.05.01_02', '24.05.01_20', '23.05.02_01', '24.05.01_02', '24.05.01_05', '24.05.01_25', '24.05.01_01', '24.05.01_27', '24.05.01_03', '27.03.04_01', '28.03.02_02', '24.05.01_23', '09.03.03_01', '10.05.03_61', '10.05.05_01', '11.03.03_21', '12.03.04_01', '28.03.02_01', '24.05.06_03', '15.03.04_61', '15.03.06_03', '15.03.06_С1', '15.05.01_02', '15.05.01_16', '16.03.01_01', '38.03.01_01', '16.03.02_01', '22.03.01_61', '23.05.02_02', '24.05.01_02', '24.05.01_24', '38.03.02_09', '24.05.01_07', '24.05.01_02', '24.05.01_12', '24.05.02_04', '24.05.02_06', '24.05.02_09', '24.05.02_01', '24.05.02_05', '27.03.05_07', '24.05.04_02', '24.05.06_01', '24.05.06_02', '24.05.06_21', '24.05.06_22', '24.05.06_22', '24.05.06_29', '24.05.06_04', '24.05.06_20', '27.03.01_01', '27.03.01_61', '27.03.04_02', '27.03.05_02', '27.03.05_03', '27.03.05_04', '27.03.05_05', '38.03.02_04', '38.03.02_07', '38.03.05_02', '38.03.05_01', '39.03.01_02', '40.05.03_01', '45.03.02_01', '45.03.03_01', '54.03.01_01', '01.03.03', '24.05.02', '09.03.01', '09.03.03', '09.03.02', '09.03.04', '09.03.04', '11.03.03', '11.03.04', '11.05.01', '12.03.04', '15.03.02', '15.03.03', '15.03.06', '15.05.01', '15.05.01', '15.05.01', '16.03.03', '16.05.01', '17.05.01', '22.03.01', '23.05.01', '24.03.01', '24.05.01', '02.03.01', '15.03.01', '01.03.02', '23.05.01', '24.05.02', '38.03.01', '02.03.01', '01.03.04', '01.03.04', '01.03.04', '09.03.01', '09.03.01', '01.03.04', '02.03.01', '02.03.01', '09.03.01', '09.03.01', '09.03.01', '02.03.01', '24.05.02', '09.03.01', '09.03.01', '09.03.03', '10.05.01', '10.05.01', '10.05.03', '10.05.03', '10.05.03', '10.05.03', '11.05.01', '11.05.01', '14.05.01', '12.03.02', '12.03.05', '12.05.01', '12.05.01', '13.03.02', '13.03.02', '13.03.02', '13.03.03', '13.03.03', '15.03.03', '15.03.04', '15.03.04', '15.03.06', '15.05.01', '15.03.06', '15.05.01', '15.05.01', '15.05.01', '15.05.02', '15.05.01', '15.05.01', '15.05.01', '15.05.01', '15.05.02', '15.05.02', '17.05.02', '19.03.01', '20.03.01', '22.03.01', '23.05.01', '24.05.01', '23.05.02', '24.05.01', '24.05.01', '24.05.01', '24.05.01', '24.05.01', '24.05.01', '27.03.04', '28.03.02', '24.05.01', '09.03.03', '10.05.03', '10.05.05', '11.03.03', '12.03.04', '28.03.02', '24.05.06', '15.03.04', '15.03.06', '15.03.06', '15.05.01', '15.05.01', '16.03.01', '38.03.01', '16.03.02', '22.03.01', '23.05.02', '24.05.01', '24.05.01', '38.03.02', '24.05.01', '24.05.01', '24.05.01', '24.05.02', '24.05.02', '24.05.02', '24.05.02', '24.05.02', '27.03.05', '24.05.04', '24.05.06', '24.05.06', '24.05.06', '24.05.06', '24.05.06', '24.05.06', '24.05.06', '24.05.06', '27.03.01', '27.03.01', '27.03.04', '27.03.05', '27.03.05', '27.03.05', '27.03.05', '38.03.02', '38.03.02', '38.03.05', '38.03.05', '39.03.01', '40.05.03', '45.03.02', '45.03.03', '54.03.01']
  matches = get_close_matches(request_user, directions, n=3, cutoff=0.4)
  
  if matches:
    return matches[0]
  else:
    return request_user